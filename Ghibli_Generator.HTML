<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime AI Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for floating labels and crisp transitions */
    .floating-label-group {
      position: relative;
    }
    .floating-label {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 1rem;
      transition: all 0.2s ease;
      pointer-events: none;
      background: transparent;
    }
    .floating-input:focus ~ .floating-label,
    .floating-input:not(:placeholder-shown) ~ .floating-label {
      top: -0.5rem;
      font-size: 0.75rem;
      color: #6C5B7B;
      background: white;
      padding: 0 0.25rem;
    }
    /* Remove blur and ensure crisp hover/focus */
    button, input, select, textarea {
      transition: all 0.3s ease;
    }
    button:focus, input:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(108, 91, 123, 0.3);
    }
    /* Smooth skeleton loader */
    .animate-pulse {
      animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    /* Modal for mobile */
    @media (max-width: 640px) {
      #modalImage {
        max-width: 95%;
        max-height: 80%;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#A7D7C5] to-[#F8B195] flex items-center justify-center p-4">
  <div class="container bg-white/95 p-4 sm:p-6 md:p-8 rounded-3xl shadow-2xl max-w-5xl w-full">
    <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-[#6C5B7B] flex items-center justify-center gap-2 mb-2">
      <span>✨</span> Anime AI Image Generator
    </h1>
    <p class="text-[#355C7D] text-center mb-4 text-sm sm:text-base">Powered by Hugging Face SDXL Ghibli LoRA | Rajesh Choudhury</p>
    <div class="mb-4 text-center">
      <p id="trialCounter" class="text-sm text-[#6C5B7B] font-medium">
        Trials remaining: <span id="trials">5000</span>
      </p>
    </div>
    <div class="space-y-4">
      <div class="floating-label-group">
        <textarea
          id="prompt"
          rows="4"
          class="floating-input w-full p-4 rounded-lg border border-gray-200 bg-gray-50 text-gray-800 focus:ring-2 focus:ring-[#6C5B7B]"
          placeholder=" "
        ></textarea>
        <label for="prompt" class="floating-label">
          Describe a magical Ghibli-style scene...
        </label>
      </div>
      <div class="floating-label-group">
        <input
          id="negativePrompt"
          type="text"
          class="floating-input w-full p-4 rounded-lg border border-gray-200 bg-gray-50 text-gray-800 focus:ring-2 focus:ring-[#6C5B7B]"
          placeholder=" "
        />
        <label for="negativePrompt" class="floating-label">
          Negative prompt (optional)
        </label>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <select
          id="aspect"
          class="p-3 rounded-lg bg-gray-50 text-[#355C7D] border border-gray-200 focus:ring-2 focus:ring-[#6C5B7B]"
          aria-label="Select aspect ratio"
        >
          <option value="square">Square (1:1)</option>
          <option value="portrait">Portrait (3:4)</option>
          <option value="landscape">Landscape (4:3)</option>
        </select>
        <select
          id="style"
          class="p-3 rounded-lg bg-gray-50 text-[#355C7D] border border-gray-200 focus:ring-2 focus:ring-[#6C5B7B]"
          aria-label="Select Ghibli style"
        >
          <option value="">Default Ghibli Style</option>
          <option value="miyazaki">Miyazaki Classic</option>
          <option value="totoro">Totoro Vibes</option>
          <option value="spirited">Spirited Away Dreamy</option>
        </select>
        <button
          onclick="generateImage()"
          id="generateBtn"
          class="p-3 rounded-lg bg-gradient-to-r from-[#6C5B7B] to-[#C06C84] text-white font-semibold hover:from-[#5B4B6A] hover:to-[#AF5B73]"
        >
          ✨ Generate Image
        </button>
      </div>
      <div class="output relative">
        <div id="skeletonLoader" class="hidden w-full h-48 sm:h-64 md:h-80 lg:h-96 bg-gray-200 rounded-xl animate-pulse"></div>
        <img
          id="outputImage"
          src=""
          alt="Generated Ghibli-style image"
          class="w-full rounded-xl shadow-lg hidden cursor-pointer"
        />
        <a id="downloadLink" class="hidden mt-4 inline-block">
          <button
            class="p-3 rounded-lg bg-gradient-to-r from-[#F8B195] to-[#F67280] text-white font-semibold hover:from-[#E7A084] hover:to-[#E5616F]"
          >
            ⬇️ Download Image
          </button>
        </a>
      </div>
    </div>
  </div>
  <div id="modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
    <span class="absolute top-4 right-4 text-white text-3xl cursor-pointer" onclick="closeModal()">×</span>
    <img id="modalImage" src="" alt="Full-size generated image" class="max-w-[90%] max-h-[90%] rounded-lg" />
  </div>

  <script>
    // Initialize trial counter
    let trials = localStorage.getItem("huggingFaceTrials") || 5000;
    document.getElementById("trials").textContent = trials;

    async function generateImage() {
      const prompt = document.getElementById("prompt").value;
      const negativePrompt = document.getElementById("negativePrompt").value;
      const style = document.getElementById("style").value;
      const aspect = document.getElementById("aspect").value;
      const outputImage = document.getElementById("outputImage");
      const downloadLink = document.getElementById("downloadLink");
      const skeletonLoader = document.getElementById("skeletonLoader");
      const generateBtn = document.getElementById("generateBtn");

      if (!prompt) {
        alert("Please enter a prompt.");
        return;
      }

      if (trials <= 0) {
        alert("No trials remaining. Please upgrade your Hugging Face plan.");
        return;
      }

      let width = 512,
        height = 512;
      if (aspect === "portrait") {
        width = 576;
        height = 768;
      } else if (aspect === "landscape") {
        width = 768;
        height = 576;
      }

      outputImage.classList.add("hidden");
      downloadLink.classList.add("hidden");
      skeletonLoader.classList.remove("hidden");
      generateBtn.disabled = true;

      let styledPrompt = `masterpiece, Studio Ghibli style, ${prompt}`;
      if (style === "miyazaki") styledPrompt += ", vibrant colors, epic landscapes";
      if (style === "totoro") styledPrompt += ", cozy, nature-focused, whimsical";
      if (style === "spirited") styledPrompt += ", dreamy, mystical, ethereal";

      try {
        const response = await fetch(
          "https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0",
          {
            method: "POST",
            headers: {
              Authorization: "Bearer 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",
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              inputs: styledPrompt,
              negative_prompt: negativePrompt || undefined,
              options: { wait_for_model: true },
              parameters: {
                width: width,
                height: height,
                guidance_scale: 8.0,
                num_inference_steps: 50,
              },
            }),
          }
        );

        if (!response.ok) {
          throw new Error("Image generation failed.");
        }

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        outputImage.src = url;
        outputImage.classList.remove("hidden");
        downloadLink.href = url;
        downloadLink.classList.remove("hidden");

        trials--;
        localStorage.setItem("huggingFaceTrials", trials);
        document.getElementById("trials").textContent = trials;
      } catch (error) {
        alert("Error: " + error.message);
      } finally {
        skeletonLoader.classList.add("hidden");
        generateBtn.disabled = false;
      }
    }

    function openModal() {
      const modal = document.getElementById("modal");
      const modalImage = document.getElementById("modalImage");
      const outputImage = document.getElementById("outputImage");
      modalImage.src = outputImage.src;
      modal.classList.remove("hidden");
      modal.classList.add("flex");
    }

    function closeModal() {
      const modal = document.getElementById("modal");
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    }

    document.getElementById("outputImage").addEventListener("click", openModal);
  </script>
</body>
</html>